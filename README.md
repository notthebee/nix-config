# nix-config

Configuration files for my NixOS and nix-darwin machines.

Very much a work in progress.

## Services

## alison

<table>
<thead>
<tr>
<th scope="col" align="left">Icon</th>
<th scope="col" align="left">Service</th>
<th scope="col" align="left">Description</th>
<th scope="col" align="left">Category</th>
</tr>
</thead>
<tbody>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/home-assistant.svg' alt='Home Assistant' width=32 height=32></td>
<td width=20%>Home Assistant</td>
<td width=65%>Home automation platform</td>
<td width=10%>Smart Home</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/png/raspberrymatic.png' alt='RaspberryMatic' width=32 height=32></td>
<td width=20%>RaspberryMatic</td>
<td width=65%>Homematic IP CCU</td>
<td width=10%>Smart Home</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/uptime-kuma.svg' alt='Uptime Kuma' width=32 height=32></td>
<td width=20%>Uptime Kuma</td>
<td width=65%>Service monitoring tool</td>
<td width=10%>Services</td>
</tr>
</tbody>
</table>

## aria

<table>
<thead>
<tr>
<th scope="col" align="left">Icon</th>
<th scope="col" align="left">Service</th>
<th scope="col" align="left">Description</th>
<th scope="col" align="left">Category</th>
</tr>
</thead>
<tbody>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/immich.svg' alt='Immich' width=32 height=32></td>
<td width=20%>Immich</td>
<td width=65%>Self-hosted photo and video management solution</td>
<td width=10%>Media</td>
</tr>
</tbody>
</table>

## emily

<table>
<thead>
<tr>
<th scope="col" align="left">Icon</th>
<th scope="col" align="left">Service</th>
<th scope="col" align="left">Description</th>
<th scope="col" align="left">Category</th>
</tr>
</thead>
<tbody>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/audiobookshelf.svg' alt='Audiobookshelf' width=32 height=32></td>
<td width=20%>Audiobookshelf</td>
<td width=65%>Audiobook and podcast player</td>
<td width=10%>Media</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/bazarr.svg' alt='Bazarr' width=32 height=32></td>
<td width=20%>Bazarr</td>
<td width=65%>Subtitle manager</td>
<td width=10%>Arr</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/deluge.svg' alt='Deluge' width=32 height=32></td>
<td width=20%>Deluge</td>
<td width=65%>Torrent client</td>
<td width=10%>Downloads</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/immich.svg' alt='Immich' width=32 height=32></td>
<td width=20%>Immich</td>
<td width=65%>Self-hosted photo and video management solution</td>
<td width=10%>Media</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/jellyfin.svg' alt='Jellyfin' width=32 height=32></td>
<td width=20%>Jellyfin</td>
<td width=65%>The Free Software Media System</td>
<td width=10%>Media</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/jellyseerr.svg' alt='Jellyseerr' width=32 height=32></td>
<td width=20%>Jellyseerr</td>
<td width=65%>Media request and discovery manager</td>
<td width=10%>Arr</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/keycloak.svg' alt='Keycloak' width=32 height=32></td>
<td width=20%>Keycloak</td>
<td width=65%>Open Source Identity and Access Management</td>
<td width=10%>Services</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/png/microbin.png' alt='Microbin' width=32 height=32></td>
<td width=20%>Microbin</td>
<td width=65%>A minimal pastebin</td>
<td width=10%>Services</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/miniflux.svg' alt='Miniflux' width=32 height=32></td>
<td width=20%>Miniflux</td>
<td width=65%>Minimalist and opinionated feed reader</td>
<td width=10%>Services</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/owncloud.svg' alt='OCIS' width=32 height=32></td>
<td width=20%>OCIS</td>
<td width=65%>Enterprise File Storage and Collaboration</td>
<td width=10%>Services</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/paperless.svg' alt='Paperless-ngx' width=32 height=32></td>
<td width=20%>Paperless-ngx</td>
<td width=65%>Document management system</td>
<td width=10%>Services</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/prowlarr.svg' alt='Prowlarr' width=32 height=32></td>
<td width=20%>Prowlarr</td>
<td width=65%>PVR indexer</td>
<td width=10%>Arr</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/radarr.svg' alt='Radarr' width=32 height=32></td>
<td width=20%>Radarr</td>
<td width=65%>Movie collection manager</td>
<td width=10%>Arr</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/radicale.svg' alt='Radicale' width=32 height=32></td>
<td width=20%>Radicale</td>
<td width=65%>Free and Open-Source CalDAV and CardDAV Server</td>
<td width=10%>Services</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/sabnzbd.svg' alt='SABnzbd' width=32 height=32></td>
<td width=20%>SABnzbd</td>
<td width=65%>The free and easy binary newsreader</td>
<td width=10%>Downloads</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/sonarr.svg' alt='Sonarr' width=32 height=32></td>
<td width=20%>Sonarr</td>
<td width=65%>TV show collection manager</td>
<td width=10%>Arr</td>
</tr>
<tr>
<td width=5%><img src='https://raw.githubusercontent.com/homarr-labs/dashboard-icons/refs/heads/main/svg/bitwarden.svg' alt='Vaultwarden' width=32 height=32></td>
<td width=20%>Vaultwarden</td>
<td width=65%>Password manager</td>
<td width=10%>Services</td>
</tr>
</tbody>
</table>

## Installation runbook (NixOS)

Create a root password using the TTY

```bash
sudo su
passwd
```

From your host, copy the public SSH key to the server

```bash
export NIXOS_HOST=192.168.2.xxx
ssh-add ~/.ssh/notthebee
ssh-copy-id -i ~/.ssh/notthebee root@$NIXOS_HOST
```

SSH into the host with agent forwarding enabled (for the secrets repo access)

```bash
ssh -A root@$NIXOS_HOST
```

Enable flakes

```bash
mkdir -p ~/.config/nix
echo "experimental-features = nix-command flakes" >> ~/.config/nix/nix.conf
```

Partition and mount the drives using [disko](https://github.com/nix-community/disko)

```bash
DISK='/dev/disk/by-id/ata-Samsung_SSD_870_EVO_250GB_S6PENL0T902873K'
DISK2='/dev/disk/by-id/ata-Samsung_SSD_870_EVO_250GB_S6PE58S586SAER'

curl https://raw.githubusercontent.com/notthebee/nix-config/main/disko/zfs-root/default.nix \
    -o /tmp/disko.nix
sed -i "s|to-be-filled-during-installation|$DISK|" /tmp/disko.nix
nix --experimental-features "nix-command flakes" run github:nix-community/disko \
    -- -m destroy,format,mount /tmp/disko.nix
```

Install git

```bash
nix-env -f '<nixpkgs>' -iA git
```

Clone this repository

```bash
mkdir -p /mnt/etc/nixos
git clone https://github.com/notthebee/nix-config.git /mnt/etc/nixos
```

Put the private key into place (required for secret management)

```bash
mkdir -p /mnt/home/notthebee/.ssh
exit
scp ~/.ssh/notthebee root@$NIXOS_HOST:/mnt/home/notthebee/.ssh
ssh root@$NIXOS_HOST
chmod 700 /mnt/home/notthebee/.ssh
chmod 600 /mnt/home/notthebee/.ssh/*
```

Install the system

```bash
nixos-install \
--root "/mnt" \
--no-root-passwd \
--flake "git+file:///mnt/etc/nixos#hostname" # alison, emily, etc.
```

Unmount the filesystems

```bash
umount "/mnt/boot/efis/*"
umount -Rl "/mnt"
zpool export -a
```

Reboot

```bash
reboot
```
